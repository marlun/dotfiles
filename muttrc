# Core setup
set folder = ~/Mail
source $XDG_CONFIG_HOME/mutt/mailboxes
source $XDG_CONFIG_HOME/mutt/conf
set spoolfile = +INBOX
set postponed = +drafts
set mbox = +archive
set record = +sent
set trash = +trash

# Setup signature and alias files
set signature = $XDG_CONFIG_HOME/mutt/sig
set alias_file = $XDG_CONFIG_HOME/mutt/aliases
source $XDG_CONFIG_HOME/mutt/aliases

# Cache folders, using these will speed up mutt
set header_cache = $XDG_CACHE_HOME/mutt
set message_cachedir = $XDG_CACHE_HOME/mutt
set tmpdir = $XDG_CACHE_HOME/mutt

# Options
unset help                        # remove top help bar
unset markers                     # don't add markers on wrapped lines
unset confirmappend               # don't ask just move
unset wait_key                    # skip message when return code is 0
unset mark_old                    # don't mark mails as old, don't use it
set fast_reply                    # don't ask just reply
set include                       # include message replied to
set pager_stop                    # don't move to next mail
set pager_index_lines = 6         # show mini index in pager
set delete                        # delete when I delete dammit
set move                          # move read mail to archive
set keep_flagged                  # don't move flagged mail to archive
set realname = "Martin Lundberg"
set wrap = 78
set sort = threads

# Remove pesky trailing whitespaces from mail
set editor="vim +FixWhitespace"

# Remove number column from default format and add weekday and time
 set index_format = "%Z %{%a %F %R} %-20.20L %s"

# Auto view HTML inside mutt pager but prefer text
auto_view text/calendar text/html
alternative_order text/calendar text/plain text/html

# Keybindings
bind pager k previous-line
bind pager j next-line
bind pager \cu half-up
bind pager \cd half-down

# Theme (color <object> <foreground> <background> [pattern])
color normal color250 color16           # default colors
color status white color26              # status bars
color indicator color16 color220        # selected item
color prompt default default            # command prompt
color message default default           # mutt messages
color error color231 color196           # mutt errors
color hdrdefault color241 default       # mail headers
color attachment color232 green         # attachment bars
color markers blue default              # wrapped line markers
color tree blue default                 # wrapped line markers
color index red default ~F              # flagged mail
color index brightgreen default ~N      # new mail
color index green default ~O            # new mail
color index color16 cyan ~T             # tagged mail
color index color231 color196 ~D        # deleted mail
color header cyan default "^Subject:"   # highlight subject
color quoted cyan default               # first level quotes
color quoted1 color175 default              # second level quotes

# Color patchces (diffs)
color body cyan default "^diff \-.*"
color body cyan default "^index [a-f0-9].*"
color body cyan default "^\-\-\- .*"
color body cyan default "^[\+]{3} .*"
color body green default "^[\+][^\+]+.*"
color body red  default "^\-[^\-]+.*"
color body brightblue default "^@@ .*"

# Show mutt version on start
push V

set query_command = "echo; grep -i %s ~/.mutt/addrs"
bind editor <Tab> complete-query

# 'L' performs a notmuch query, showing only the results
macro index L "<enter-command>unset wait_key<enter><shell-escape>read -p 'notmuch query: ' x; echo \$x >~/.cache/mutt_terms<enter><limit>~i \"\`notmuch search --output=messages \$(cat ~/.cache/mutt_terms) | head -n 600 | perl -le '@a=<>;chomp@a;s/\^id:// for@a;$,=\"|\";print@a'\`\"<enter>" "show only messages matching a notmuch pattern"

# Edit then source the aliases file (\e means ESC)
macro index \ea "!vim ~/.config/mutt/aliases\n:source ~/.config/mutt/aliases\n"
